generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model InternshipApplication {
  id             String            @id
  firstName      String
  lastName       String
  email          String
  universityId   String
  majorId        String
  semester       String
  portfolioUrl   String?
  motivation     String
  cvUrl          String?
  roleId         String
  status         ApplicationStatus @default(PENDING)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime
  Major          Major             @relation(fields: [majorId], references: [id])
  InternshipRole InternshipRole    @relation(fields: [roleId], references: [id])
  University     University        @relation(fields: [universityId], references: [id])

  @@index([createdAt])
  @@index([email])
  @@index([firstName])
  @@index([lastName])
  @@index([status])
}

model InternshipRole {
  id                    String                  @id
  title                 String
  department            String
  type                  String
  location              String
  isActive              Boolean                 @default(true)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  slug                  String                  @unique
  requirements          String[]
  responsibilities      String[]
  InternshipApplication InternshipApplication[]
}

model Major {
  id                    String                  @id
  name                  String                  @unique
  InternshipApplication InternshipApplication[]
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model University {
  id                    String                  @id
  name                  String                  @unique
  InternshipApplication InternshipApplication[]
}

model User {
  id              String           @id
  name            String?
  email           String?          @unique
  emailVerified   DateTime?
  image           String?
  role            String?          @default("user")
  password        String?
  referral_code   String?          @db.VarChar
  status          Boolean          @default(false)
  Account         Account[]
  paymentAccounts PaymentAccount[]
  Session         Session[]
}

model PaymentAccount {
  id            String   @id
  userId        String
  type          String
  providerName  String
  accountNumber String
  accountName   String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  User          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Payment {
  id             Int       @id @default(autoincrement())
  order_id       String    @unique @db.VarChar(255)
  name           String    @db.VarChar(255)
  email          String    @db.VarChar(255)
  phone          String    @db.VarChar(20)
  amount         Decimal   @default(145000) @db.Decimal(12, 2)
  status         String?   @default("pending") @db.VarChar(50)
  midtrans_token String?   @db.VarChar(255)
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  updated_at     DateTime? @default(now()) @db.Timestamptz(6)
  referral_code  String?   @db.VarChar(255)
  withdrawId     String?   @db.VarChar(255)
  Withdraw       Withdraw? @relation(fields: [withdrawId], references: [id])

  @@map("payments")
}

model Withdraw {
  id             String    @id @default(uuid())
  amount         Int
  status         String    @default("pending") // pending, approved, rejected
  user_email     String
  bank_name      String
  account_number String
  account_name   String
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  
  payments       Payment[]

  @@map("withdrawals")
  @@index([user_email])
}

model orders {
  id         Int       @id @default(autoincrement())
  name       String
  email      String
  whatsapp   String
  amount     Int       @default(149000)
  status     String    @default("pending")
  created_at DateTime? @default(now()) @db.Timestamp(6)
}

model ukasir_token {
  token_number  String    @id @db.VarChar(255)
  register_date DateTime? @default(now()) @db.Timestamp(6)
  status_active Boolean?  @default(true)
  device_id     String?   @db.VarChar(255)
  device_name   String?   @db.VarChar(255)
  device_type   String?   @db.VarChar(255)
  order_id      String?   @db.VarChar(255)
  name          String?   @db.VarChar(255)
  email         String?   @db.VarChar(255)
  phone         String?   @db.VarChar(20)
  referral_code String?   @db.VarChar(255)
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  INTERVIEWING
  OFFERED
  REJECTED
  ACCEPTED
}
